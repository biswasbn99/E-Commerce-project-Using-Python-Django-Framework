{% extends "homepage/base.html" %}
{% block title %}Sales Analytics Dashboard{% endblock %}

{% block content %}
<style>
  .dashboard-container {
    max-width: 1400px;
    margin: 20px auto;
    padding: 20px;
    background: #f8f9fa;
    min-height: 100vh;
  }
  
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    background: #fff;
    padding: 20px 30px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  
  .dashboard-title {
    color: #2c3e50;
    font-size: 28px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    text-align: center;
    transition: transform 0.2s;
  }
  
  .stat-card:hover {
    transform: translateY(-2px);
  }
  
  .stat-icon {
    font-size: 40px;
    margin-bottom: 15px;
    display: block;
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 8px;
    color: #2c3e50;
  }
  
  .stat-label {
    color: #7f8c8d;
    font-size: 14px;
    font-weight: 500;
  }
  
  .chart-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .chart-container {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  
  .chart-title {
    font-size: 18px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .chart-canvas {
    width: 100%;
    height: 300px;
  }
  
  .products-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .top-products {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  
  .product-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #ecf0f1;
  }
  
  .product-item:last-child {
    border-bottom: none;
  }
  
  .product-name {
    font-weight: 500;
    color: #2c3e50;
  }
  
  .product-stats {
    text-align: right;
  }
  
  .product-sold {
    font-weight: 600;
    color: #27ae60;
  }
  
  .product-revenue {
    font-size: 12px;
    color: #7f8c8d;
  }
  
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .btn-primary {
    background: #3498db;
    color: white;
  }
  
  .btn-secondary {
    background: #95a5a6;
    color: white;
  }
  
  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  
  /* Revenue cards with different colors */
  .revenue-daily { border-left: 4px solid #e74c3c; }
  .revenue-weekly { border-left: 4px solid #f39c12; }
  .revenue-monthly { border-left: 4px solid #27ae60; }
  
  .order-daily { border-left: 4px solid #9b59b6; }
  .order-weekly { border-left: 4px solid #3498db; }
  .order-monthly { border-left: 4px solid #1abc9c; }
  
  @media (max-width: 768px) {
    .dashboard-container {
      padding: 10px;
      margin: 10px;
    }
    
    .dashboard-header {
      flex-direction: column;
      gap: 15px;
      text-align: center;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .chart-grid {
      grid-template-columns: 1fr;
    }
    
    .products-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">
      üìä Sales Analytics Dashboard
    </h1>
    <div>
      <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">
        ‚Üê Back to Dashboard
      </a>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <!-- Revenue Stats -->
    <div class="stat-card revenue-daily">
      <span class="stat-icon">üí∞</span>
      <div class="stat-value">‡ß≥{{ daily_revenue|floatformat:0 }}</div>
      <div class="stat-label">Today's Revenue</div>
    </div>
    
    <div class="stat-card revenue-weekly">
      <span class="stat-icon">üíµ</span>
      <div class="stat-value">‡ß≥{{ weekly_revenue|floatformat:0 }}</div>
      <div class="stat-label">Weekly Revenue</div>
    </div>
    
    <div class="stat-card revenue-monthly">
      <span class="stat-icon">üíé</span>
      <div class="stat-value">‡ß≥{{ monthly_revenue|floatformat:0 }}</div>
      <div class="stat-label">Monthly Revenue</div>
    </div>
    
    <!-- Order Stats -->
    <div class="stat-card order-daily">
      <span class="stat-icon">üì¶</span>
      <div class="stat-value">{{ daily_orders }}</div>
      <div class="stat-label">Today's Orders</div>
    </div>
    
    <div class="stat-card order-weekly">
      <span class="stat-icon">üìã</span>
      <div class="stat-value">{{ weekly_orders }}</div>
      <div class="stat-label">Weekly Orders</div>
    </div>
    
    <div class="stat-card order-monthly">
      <span class="stat-icon">üìä</span>
      <div class="stat-value">{{ monthly_orders }}</div>
      <div class="stat-label">Monthly Orders</div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="chart-grid">
    <!-- Revenue Trend Chart -->
    <div class="chart-container">
      <h3 class="chart-title">üìà Revenue Trend (Last 7 Days)</h3>
      <canvas id="revenueChart" class="chart-canvas"></canvas>
    </div>
    
    <!-- Order Status Distribution -->
    <div class="chart-container">
      <h3 class="chart-title">üìä Order Status Distribution</h3>
      <canvas id="statusChart" class="chart-canvas"></canvas>
    </div>
  </div>

  <!-- Monthly Performance Chart -->
  <div class="chart-container">
    <h3 class="chart-title">üìÖ Monthly Performance (Last 12 Months)</h3>
    <canvas id="monthlyChart" class="chart-canvas"></canvas>
  </div>

  <!-- Products Analysis -->
  <div class="products-grid">
    <!-- Top Selling Products -->
    <div class="top-products">
      <h3 class="chart-title">üèÜ Top Selling Products (Last 30 Days)</h3>
      {% if top_products %}
        {% for product in top_products %}
        <div class="product-item">
          <div class="product-name">{{ product.product__name }}</div>
          <div class="product-stats">
            <div class="product-sold">{{ product.total_sold }} sold</div>
            <div class="product-revenue">‡ß≥{{ product.total_revenue|floatformat:0 }}</div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <p style="text-align: center; color: #7f8c8d; padding: 20px;">No product sales data available</p>
      {% endif %}
    </div>
    
    <!-- Order Statistics -->
    <div class="top-products">
      <h3 class="chart-title">üìã Order Statistics Summary</h3>
      <div class="product-item">
        <div class="product-name">Average Daily Revenue</div>
        <div class="product-stats">
          <div class="product-sold">
            ‡ß≥{{ avg_daily_revenue|floatformat:0 }}
          </div>
        </div>
      </div>
      <div class="product-item">
        <div class="product-name">Average Order Value</div>
        <div class="product-stats">
          <div class="product-sold">
            ‡ß≥{{ avg_order_value|floatformat:0 }}
          </div>
        </div>
      </div>
      <div class="product-item">
        <div class="product-name">Growth Trend</div>
        <div class="product-stats">
          <div class="product-sold" style="color: #27ae60;">üìà Positive</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Revenue Trend Chart (Last 7 Days)
const revenueCtx = document.getElementById('revenueChart').getContext('2d');
new Chart(revenueCtx, {
    type: 'line',
    data: {
        labels: {{ last_7_days_labels|safe }},
        datasets: [{
            label: 'Revenue (‡ß≥)',
            data: {{ last_7_days_revenue|safe }},
            borderColor: '#3498db',
            backgroundColor: 'rgba(52, 152, 219, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
        }, {
            label: 'Orders',
            data: {{ last_7_days_orders|safe }},
            borderColor: '#e74c3c',
            backgroundColor: 'rgba(231, 76, 60, 0.1)',
            borderWidth: 3,
            fill: false,
            tension: 0.4,
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'Revenue (‡ß≥)'
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'Orders'
                },
                grid: {
                    drawOnChartArea: false
                }
            }
        },
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});

// Order Status Distribution Chart
const statusCtx = document.getElementById('statusChart').getContext('2d');
const statusData = {{ status_data|safe }};
const statusLabels = statusData.map(item => item.status.charAt(0).toUpperCase() + item.status.slice(1));
const statusCounts = statusData.map(item => item.count);

new Chart(statusCtx, {
    type: 'doughnut',
    data: {
        labels: statusLabels,
        datasets: [{
            data: statusCounts,
            backgroundColor: [
                '#f39c12',  // pending
                '#27ae60',  // confirmed
                '#3498db',  // shipped
                '#9b59b6',  // delivered
                '#e74c3c'   // cancelled
            ],
            borderWidth: 2,
            borderColor: '#fff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Monthly Performance Chart
const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'bar',
    data: {
        labels: {{ monthly_labels|safe }},
        datasets: [{
            label: 'Revenue (‡ß≥)',
            data: {{ monthly_revenue_data|safe }},
            backgroundColor: 'rgba(52, 152, 219, 0.8)',
            borderColor: '#3498db',
            borderWidth: 1,
            yAxisID: 'y'
        }, {
            label: 'Orders',
            data: {{ monthly_order_data|safe }},
            backgroundColor: 'rgba(231, 76, 60, 0.8)',
            borderColor: '#e74c3c',
            borderWidth: 1,
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'Revenue (‡ß≥)'
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'Orders'
                },
                grid: {
                    drawOnChartArea: false
                }
            }
        },
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});
</script>

{% endblock %}